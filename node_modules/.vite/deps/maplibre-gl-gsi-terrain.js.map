{
  "version": 3,
  "sources": ["../../maplibre-gl-gsi-terrain/dist/terrain.js"],
  "sourcesContent": ["const u = `\nfunction gsidem2terrarium(r, g, b) {\n\tlet rgb = (r << 16) + (g << 8) + b;\n\tlet h = 0;\n\tif (rgb < 0x800000) h = rgb * 0.01;\n\telse if (rgb > 0x800000) h = (rgb - Math.pow(2, 24)) * 0.01;\n\tconst value = h + 32768;\n\tconst tR = Math.floor(value / 256);\n\tconst tG = Math.floor(value) % 256;\n\tconst tB = Math.floor((value - Math.floor(value)) * 256);\n\treturn [tR, tG, tB];\n}\n\nself.onmessage = async (e) => {\n\tconst { imageBitmap, id } = e.data;\n\tconst canvas = new OffscreenCanvas(imageBitmap.width, imageBitmap.height);\n\tconst context = canvas.getContext('2d', { willReadFrequently: true });\n\n\t// \\u7121\\u52B9\\u5024\\u306E\\u30D5\\u30A9\\u30FC\\u30EB\\u30D0\\u30C3\\u30AF\\u7528\\u306B\\u80CC\\u666F\\u3092\\u5857\\u308A\\u3064\\u3076\\u3059\n\tcontext.fillStyle = 'rgb(128,0,0)';\n\tcontext.fillRect(0, 0, canvas.width, canvas.height);\n\n\tcontext.drawImage(imageBitmap, 0, 0);\n\timageBitmap.close();\n\n\tconst imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n\tfor (let i = 0; i < imageData.data.length / 4; i++) {\n\t\tconst tRGB = gsidem2terrarium(\n\t\t\timageData.data[i * 4],\n\t\t\timageData.data[i * 4 + 1],\n\t\t\timageData.data[i * 4 + 2],\n\t\t);\n\t\timageData.data[i * 4] = tRGB[0];\n\t\timageData.data[i * 4 + 1] = tRGB[1];\n\t\timageData.data[i * 4 + 2] = tRGB[2];\n\t}\n\tcontext.putImageData(imageData, 0, 0);\n\n\tconst blob = await canvas.convertToBlob({ type: 'image/png' });\n\tconst arrayBuffer = await blob.arrayBuffer();\n\tconst png = new Uint8Array(arrayBuffer);\n\tself.postMessage({ png, id }, [png.buffer]);\n};\n`;\nlet s = null, m = 0;\nconst c = /* @__PURE__ */ new Map();\nfunction f() {\n  if (!s) {\n    const n = new Blob([u], { type: \"application/javascript\" });\n    s = new Worker(URL.createObjectURL(n)), s.onmessage = (t) => {\n      const { png: e, id: a } = t.data, r = c.get(a);\n      r && (r.resolve(e), c.delete(a));\n    }, s.onerror = (t) => {\n      c.forEach(\n        (e) => e.reject(new Error(t.message))\n      ), c.clear();\n    };\n  }\n  return s;\n}\nasync function d(n) {\n  const t = await fetch(n);\n  if (!t.ok)\n    throw new Error(`Failed to fetch: ${t.status}`);\n  const e = await t.blob(), a = await createImageBitmap(e);\n  return new Promise((r, o) => {\n    const i = m++;\n    c.set(i, { resolve: r, reject: o }), f().postMessage({ imageBitmap: a, id: i }, [a]);\n  });\n}\nfunction h(n, t, e) {\n  let a = (n << 16) + (t << 8) + e, r = 0;\n  a < 8388608 ? r = a * 0.01 : a > 8388608 && (r = (a - Math.pow(2, 24)) * 0.01);\n  const o = r + 32768, i = Math.floor(o / 256), g = Math.floor(o) % 256, l = Math.floor((o - Math.floor(o)) * 256);\n  return [i, g, l];\n}\nconst b = (n, t = {}) => {\n  var o, i, g, l;\n  const e = \"gsidem\", a = p(e);\n  return n(e, a), {\n    type: \"raster-dem\",\n    encoding: \"terrarium\",\n    tiles: [`gsidem://${(o = t.tileUrl) != null ? o : \"https://cyberjapandata.gsi.go.jp/xyz/dem_png/{z}/{x}/{y}.png\"}`],\n    tileSize: 256,\n    minzoom: (i = t.minzoom) != null ? i : 1,\n    maxzoom: (g = t.maxzoom) != null ? g : 14,\n    attribution: (l = t.attribution) != null ? l : \"\"\n  };\n}, p = (n) => async (t, e) => {\n  const a = t.url.replace(`${n}://`, \"\");\n  return { data: await d(a).catch((o) => {\n    throw e.abort(), o.message;\n  }) };\n};\nexport {\n  p as getGsiDemProtocolAction,\n  h as gsidem2terrarium,\n  b as useGsiTerrainSource\n};\n"],
  "mappings": "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",
  "names": []
}
